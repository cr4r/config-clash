import{aj as ge,ak as j,r as L,al as Ie,L as $,am as Se,D as Z,Y as ye,an as ee,ao as te,b as z,j as v,X as _e,B as Re,u as re,d as Te,g as Me,C as ze,h as we}from"./index.c4329538.js";import{R as ne,T as Oe}from"./TextFitler.03606beb.js";import{f as xe}from"./index.d031e288.js";import{F as be,p as Ce}from"./Fab.a209fdc9.js";import{u as Ne}from"./useRemainingViewPortHeight.3208ea71.js";import"./rotate-cw.b40f6505.js";import"./debounce.c2d20996.js";function H(t,e){if(t==null)return{};var r={},i=Object.keys(t),a,o;for(o=0;o<i.length;o++)a=i[o],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}function Pe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ge(t,e)}var Q=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function ke(t,e){return!!(t===e||Q(t)&&Q(e))}function Ee(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!ke(t[r],e[r]))return!1;return!0}function F(t,e){e===void 0&&(e=Ee);var r,i=[],a,o=!1;function s(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];return o&&r===this&&e(u,i)||(a=t.apply(this,u),o=!0,r=this,i=u),a}return s}var Le=typeof performance=="object"&&typeof performance.now=="function",K=Le?function(){return performance.now()}:function(){return Date.now()};function V(t){cancelAnimationFrame(t.id)}function De(t,e){var r=K();function i(){K()-r>=e?t.call(null):a.id=requestAnimationFrame(i)}var a={id:requestAnimationFrame(i)};return a}var b=null;function G(t){if(t===void 0&&(t=!1),b===null||t){var e=document.createElement("div"),r=e.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var i=document.createElement("div"),a=i.style;return a.width="100px",a.height="100px",e.appendChild(i),document.body.appendChild(e),e.scrollLeft>0?b="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?b="negative":b="positive-ascending"),document.body.removeChild(e),b}return b}var Fe=150,Ae=function(e,r){return e};function $e(t){var e,r=t.getItemOffset,i=t.getEstimatedTotalSize,a=t.getItemSize,o=t.getOffsetForIndexAndAlignment,s=t.getStartIndexForOffset,u=t.getStopIndexForStartIndex,f=t.initInstanceProps,g=t.shouldResetStyleCacheOnItemSizeChange,_=t.validateProps;return e=function(R){Pe(M,R);function M(p){var n;return n=R.call(this,p)||this,n._instanceProps=f(n.props,j(n)),n._outerRef=void 0,n._resetIsScrollingTimeoutId=null,n.state={instance:j(n),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof n.props.initialScrollOffset=="number"?n.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},n._callOnItemsRendered=void 0,n._callOnItemsRendered=F(function(l,c,d,m){return n.props.onItemsRendered({overscanStartIndex:l,overscanStopIndex:c,visibleStartIndex:d,visibleStopIndex:m})}),n._callOnScroll=void 0,n._callOnScroll=F(function(l,c,d){return n.props.onScroll({scrollDirection:l,scrollOffset:c,scrollUpdateWasRequested:d})}),n._getItemStyle=void 0,n._getItemStyle=function(l){var c=n.props,d=c.direction,m=c.itemSize,S=c.layout,h=n._getItemStyleCache(g&&m,g&&S,g&&d),I;if(h.hasOwnProperty(l))I=h[l];else{var y=r(n.props,l,n._instanceProps),w=a(n.props,l,n._instanceProps),O=d==="horizontal"||S==="horizontal",k=d==="rtl",E=O?y:0;h[l]=I={position:"absolute",left:k?void 0:E,right:k?E:void 0,top:O?0:y,height:O?"100%":w,width:O?w:"100%"}}return I},n._getItemStyleCache=void 0,n._getItemStyleCache=F(function(l,c,d){return{}}),n._onScrollHorizontal=function(l){var c=l.currentTarget,d=c.clientWidth,m=c.scrollLeft,S=c.scrollWidth;n.setState(function(h){if(h.scrollOffset===m)return null;var I=n.props.direction,y=m;if(I==="rtl")switch(G()){case"negative":y=-m;break;case"positive-descending":y=S-d-m;break}return y=Math.max(0,Math.min(y,S-d)),{isScrolling:!0,scrollDirection:h.scrollOffset<m?"forward":"backward",scrollOffset:y,scrollUpdateWasRequested:!1}},n._resetIsScrollingDebounced)},n._onScrollVertical=function(l){var c=l.currentTarget,d=c.clientHeight,m=c.scrollHeight,S=c.scrollTop;n.setState(function(h){if(h.scrollOffset===S)return null;var I=Math.max(0,Math.min(S,m-d));return{isScrolling:!0,scrollDirection:h.scrollOffset<I?"forward":"backward",scrollOffset:I,scrollUpdateWasRequested:!1}},n._resetIsScrollingDebounced)},n._outerRefSetter=function(l){var c=n.props.outerRef;n._outerRef=l,typeof c=="function"?c(l):c!=null&&typeof c=="object"&&c.hasOwnProperty("current")&&(c.current=l)},n._resetIsScrollingDebounced=function(){n._resetIsScrollingTimeoutId!==null&&V(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=De(n._resetIsScrolling,Fe)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},function(){n._getItemStyleCache(-1,null)})},n}M.getDerivedStateFromProps=function(n,l){return We(n,l),_(n),null};var T=M.prototype;return T.scrollTo=function(n){n=Math.max(0,n),this.setState(function(l){return l.scrollOffset===n?null:{scrollDirection:l.scrollOffset<n?"forward":"backward",scrollOffset:n,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},T.scrollToItem=function(n,l){l===void 0&&(l="auto");var c=this.props.itemCount,d=this.state.scrollOffset;n=Math.max(0,Math.min(n,c-1)),this.scrollTo(o(this.props,n,l,d,this._instanceProps))},T.componentDidMount=function(){var n=this.props,l=n.direction,c=n.initialScrollOffset,d=n.layout;if(typeof c=="number"&&this._outerRef!=null){var m=this._outerRef;l==="horizontal"||d==="horizontal"?m.scrollLeft=c:m.scrollTop=c}this._callPropsCallbacks()},T.componentDidUpdate=function(){var n=this.props,l=n.direction,c=n.layout,d=this.state,m=d.scrollOffset,S=d.scrollUpdateWasRequested;if(S&&this._outerRef!=null){var h=this._outerRef;if(l==="horizontal"||c==="horizontal")if(l==="rtl")switch(G()){case"negative":h.scrollLeft=-m;break;case"positive-ascending":h.scrollLeft=m;break;default:var I=h.clientWidth,y=h.scrollWidth;h.scrollLeft=y-I-m;break}else h.scrollLeft=m;else h.scrollTop=m}this._callPropsCallbacks()},T.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&V(this._resetIsScrollingTimeoutId)},T.render=function(){var n=this.props,l=n.children,c=n.className,d=n.direction,m=n.height,S=n.innerRef,h=n.innerElementType,I=n.innerTagName,y=n.itemCount,w=n.itemData,O=n.itemKey,k=O===void 0?Ae:O,E=n.layout,ce=n.outerElementType,ue=n.outerTagName,de=n.style,fe=n.useIsScrolling,me=n.width,W=this.state.isScrolling,D=d==="horizontal"||E==="horizontal",he=D?this._onScrollHorizontal:this._onScrollVertical,U=this._getRangeToRender(),ve=U[0],pe=U[1],B=[];if(y>0)for(var N=ve;N<=pe;N++)B.push(L.exports.createElement(l,{data:w,key:k(N,w),index:N,isScrolling:fe?W:void 0,style:this._getItemStyle(N)}));var q=i(this.props,this._instanceProps);return L.exports.createElement(ce||ue||"div",{className:c,onScroll:he,ref:this._outerRefSetter,style:Ie({position:"relative",height:m,width:me,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:d},de)},L.exports.createElement(h||I||"div",{children:B,ref:S,style:{height:D?"100%":q,pointerEvents:W?"none":void 0,width:D?q:"100%"}}))},T._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var n=this.props.itemCount;if(n>0){var l=this._getRangeToRender(),c=l[0],d=l[1],m=l[2],S=l[3];this._callOnItemsRendered(c,d,m,S)}}if(typeof this.props.onScroll=="function"){var h=this.state,I=h.scrollDirection,y=h.scrollOffset,w=h.scrollUpdateWasRequested;this._callOnScroll(I,y,w)}},T._getRangeToRender=function(){var n=this.props,l=n.itemCount,c=n.overscanCount,d=this.state,m=d.isScrolling,S=d.scrollDirection,h=d.scrollOffset;if(l===0)return[0,0,0,0];var I=s(this.props,h,this._instanceProps),y=u(this.props,I,h,this._instanceProps),w=!m||S==="backward"?Math.max(1,c):1,O=!m||S==="forward"?Math.max(1,c):1;return[Math.max(0,I-w),Math.max(0,Math.min(l-1,y+O)),I,y]},M}(L.exports.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var We=function(e,r){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,r.instance},Ue=50,C=function(e,r,i){var a=e,o=a.itemSize,s=i.itemMetadataMap,u=i.lastMeasuredIndex;if(r>u){var f=0;if(u>=0){var g=s[u];f=g.offset+g.size}for(var _=u+1;_<=r;_++){var R=o(_);s[_]={offset:f,size:R},f+=R}i.lastMeasuredIndex=r}return s[r]},Be=function(e,r,i){var a=r.itemMetadataMap,o=r.lastMeasuredIndex,s=o>0?a[o].offset:0;return s>=i?ie(e,r,o,0,i):qe(e,r,Math.max(0,o),i)},ie=function(e,r,i,a,o){for(;a<=i;){var s=a+Math.floor((i-a)/2),u=C(e,s,r).offset;if(u===o)return s;u<o?a=s+1:u>o&&(i=s-1)}return a>0?a-1:0},qe=function(e,r,i,a){for(var o=e.itemCount,s=1;i<o&&C(e,i,r).offset<a;)i+=s,s*=2;return ie(e,r,Math.min(i,o-1),Math.floor(i/2),a)},J=function(e,r){var i=e.itemCount,a=r.itemMetadataMap,o=r.estimatedItemSize,s=r.lastMeasuredIndex,u=0;if(s>=i&&(s=i-1),s>=0){var f=a[s];u=f.offset+f.size}var g=i-s-1,_=g*o;return u+_},je=$e({getItemOffset:function(e,r,i){return C(e,r,i).offset},getItemSize:function(e,r,i){return i.itemMetadataMap[r].size},getEstimatedTotalSize:J,getOffsetForIndexAndAlignment:function(e,r,i,a,o){var s=e.direction,u=e.height,f=e.layout,g=e.width,_=s==="horizontal"||f==="horizontal",R=_?g:u,M=C(e,r,o),T=J(e,o),p=Math.max(0,Math.min(T-R,M.offset)),n=Math.max(0,M.offset-R+M.size);switch(i==="smart"&&(a>=n-R&&a<=p+R?i="auto":i="center"),i){case"start":return p;case"end":return n;case"center":return Math.round(n+(p-n)/2);case"auto":default:return a>=n&&a<=p?a:a<n?n:p}},getStartIndexForOffset:function(e,r,i){return Be(e,i,r)},getStopIndexForStartIndex:function(e,r,i,a){for(var o=e.direction,s=e.height,u=e.itemCount,f=e.layout,g=e.width,_=o==="horizontal"||f==="horizontal",R=_?g:s,M=C(e,r,a),T=i+R,p=M.offset+M.size,n=r;n<u-1&&p<T;)n++,p+=C(e,n,a).size;return n},initInstanceProps:function(e,r){var i=e,a=i.estimatedItemSize,o={itemMetadataMap:{},estimatedItemSize:a||Ue,lastMeasuredIndex:-1};return r.resetAfterIndex=function(s,u){u===void 0&&(u=!0),o.lastMeasuredIndex=Math.min(o.lastMeasuredIndex,s-1),r._getItemStyleCache(-1),u&&r.forceUpdate()},o},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function X(t,e){for(var r in t)if(!(r in e))return!0;for(var i in e)if(t[i]!==e[i])return!0;return!1}var He=["style"],Qe=["style"];function Ke(t,e){var r=t.style,i=H(t,He),a=e.style,o=H(e,Qe);return!X(r,a)&&!X(i,o)}function Ve(t){const e=t.providers,r=Object.keys(e),i={};for(let a=0;a<r.length;a++){const o=r[a];i[o]={...e[o],idx:a}}return{byName:i,names:r}}async function Ge(t,e){const{url:r,init:i}=$(e);let a={providers:{}};try{const o=await fetch(r+t,i);o.ok&&(a=await o.json())}catch(o){console.log("failed to GET /providers/rules",o)}return Ve(a)}async function ae({name:t,apiConfig:e}){const{url:r,init:i}=$(e);try{return(await fetch(r+`/providers/rules/${t}`,{method:"PUT",...i})).ok}catch(a){return console.log("failed to PUT /providers/rules/:name",a),!1}}async function Je({names:t,apiConfig:e}){for(let r=0;r<t.length;r++)await ae({name:t[r],apiConfig:e})}var Xe=function(t,e,r,i,a,o,s,u){if(!t){var f;if(e===void 0)f=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var g=[r,i,a,o,s,u],_=0;f=new Error(e.replace(/%s/g,function(){return g[_++]})),f.name="Invariant Violation"}throw f.framesToPop=1,f}},Ye=Xe;function Ze(t){return Ye(t.rules&&t.rules.length>=0,"there is no valid rules list in the rules API response"),t.rules.map((e,r)=>({...e,id:r}))}async function et(t,e){let r={rules:[]};try{const{url:i,init:a}=$(e),o=await fetch(i+t,a);o.ok&&(r=await o.json())}catch(i){console.log("failed to fetch rules",i)}return Ze(r)}const oe=Se({key:"ruleFilterText",default:""});function tt(t,e){const r=ee(),{mutate:i,isLoading:a}=te(ae,{onSuccess:()=>{r.invalidateQueries(["/providers/rules"])}});return[s=>{s.preventDefault(),i({name:t,apiConfig:e})},a]}function rt(t){const e=ee(),{data:r}=se(t),{mutate:i,isLoading:a}=te(Je,{onSuccess:()=>{e.invalidateQueries(["/providers/rules"])}});return[s=>{s.preventDefault(),i({names:r.names,apiConfig:t})},a]}function se(t){return Z(["/providers/rules",t],()=>Ge("/providers/rules",t))}function nt(t){const{data:e,isFetching:r}=Z(["/rules",t],()=>et("/rules",t)),{data:i}=se(t),[a]=ye(oe);if(a==="")return{rules:e,provider:i,isFetching:r};{const o=a.toLowerCase();return{rules:e.filter(s=>s.payload.toLowerCase().indexOf(o)>=0),isFetching:r,provider:{byName:i.byName,names:i.names.filter(s=>s.toLowerCase().indexOf(o)>=0)}}}}const it="_RuleProviderItem_1vl8n_1",at="_left_1vl8n_7",ot="_middle_1vl8n_14",st="_gray_1vl8n_21",lt="_action_1vl8n_25",ct="_refreshBtn_1vl8n_32",x={RuleProviderItem:it,left:at,middle:ot,gray:st,action:lt,refreshBtn:ct};function ut({idx:t,name:e,vehicleType:r,behavior:i,updatedAt:a,ruleCount:o,apiConfig:s}){const[u,f]=tt(e,s),g=xe(new Date(a),new Date);return z("div",{className:x.RuleProviderItem,children:[v("span",{className:x.left,children:t}),z("div",{className:x.middle,children:[v(_e,{name:e,type:`${r} / ${i}`}),v("div",{className:x.gray,children:o<2?`${o} rule`:`${o} rules`}),z("div",{className:x.action,children:[z(Re,{onClick:u,disabled:f,className:x.refreshBtn,children:[v(ne,{isRotating:f,size:13}),v("span",{className:"visually-hidden",children:"Refresh"})]}),z("small",{className:x.gray,children:["Updated ",g," ago"]})]})]})]})}function dt({apiConfig:t}){const[e,r]=rt(t),{t:i}=re();return v(be,{icon:v(ne,{isRotating:r}),text:i("update_all_rule_provider"),style:Ce,onClick:e})}const ft="_rule_gbh4t_1",mt="_left_gbh4t_12",ht="_a_gbh4t_19",vt="_b_gbh4t_26",pt="_type_gbh4t_37",P={rule:ft,left:mt,a:ht,b:vt,type:pt},A={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function gt({proxy:t}){let e=A._default;return A[t]&&(e=A[t]),{color:e}}function It({type:t,payload:e,proxy:r,id:i}){const a=gt({proxy:r});return z("div",{className:P.rule,children:[v("div",{className:P.left,children:i}),z("div",{children:[v("div",{className:P.b,children:e}),z("div",{className:P.a,children:[v("div",{className:P.type,children:t}),v("div",{style:a,children:r})]})]})]})}const St="_header_1j1w3_1",yt="_RuleProviderItemWrapper_1j1w3_17",le={header:St,RuleProviderItemWrapper:yt},{memo:_t}=we,Y=30;function Rt(t,{rules:e,provider:r}){const i=r.names.length;return t<i?r.names[t]:e[t-i].id}function Tt({provider:t}){return function(r){const i=t.names.length;return r<i?110:80}}const Mt=_t(({index:t,style:e,data:r})=>{const{rules:i,provider:a,apiConfig:o}=r,s=a.names.length;if(t<s){const f=a.names[t],g=a.byName[f];return v("div",{style:e,className:le.RuleProviderItemWrapper,children:v(ut,{apiConfig:o,...g})})}const u=i[t-s];return v("div",{style:e,children:v(It,{...u})})},Ke),zt=t=>({apiConfig:Me(t)}),Et=Te(zt)(wt);function wt({apiConfig:t}){const[e,r]=Ne(),{rules:i,provider:a}=nt(t),o=Tt({provider:a}),{t:s}=re();return z("div",{children:[z("div",{className:le.header,children:[v(ze,{title:s("Rules")}),v(Oe,{placeholder:"Filter",textAtom:oe})]}),v("div",{ref:e,style:{paddingBottom:Y},children:v(je,{height:r-Y,width:"100%",itemCount:i.length+a.names.length,itemSize:o,itemData:{rules:i,provider:a,apiConfig:t},itemKey:Rt,children:Mt})}),a&&a.names&&a.names.length>0?v(dt,{apiConfig:t}):null]})}export{Et as default};
